/*! FactoryJS 1.0.1 */
(function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};define(["underscore","jquery","backbone"],function(c,d,e){var f;return f=function(){function f(a,b){null==b&&(b={}),this.mixins={},this.tagCbs={},this.tagMap={},this.promises={},this.instances={},this.definitions={},this.define("Base",a),this.baseTags=b.baseTags||[],this.on("create",this.handleCreate,this)}var g,h;return c.extend(f.prototype,e.Events),h=function(a,b){var d,e,g,h,i;null==a&&(a={}),null==b&&(b={}),h=[];for(g in b)d=b[g],i=null!=a[g]?a[g]:a[g]=d,e=c.isObject(i)||c.isObject(d),e&&(c.isDate(i)||c.isDate(d)||c.isElement(i)||c.isElement(d)||c.isFunction(i)||c.isFunction(d)||c.isRegExp(i)||c.isRegExp(d)||h.push(a[g]=f.composeConfig(d,i)));return h},g=function(){var b,d,e;return d=arguments[0],e=arguments[1],b=3<=arguments.length?a.call(arguments,2):[],c.isFunction(d)&&(d=d.apply(this,b)),c.isFunction(e)&&(e=e.apply(this,b)),null==e?c.clone(d):c.isArray(d)&&c.isArray(e)?[].concat(d,e):c.extend({},d,e)},f.composeConfig=function(){var b,d;return b=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],c.reduce(d,function(b,d){return c.isFunction(b)||c.isFunction(d)?function(){return g.call.apply(g,[this,b,d].concat(a.call(arguments)))}:g(b,d)},b)},f.prototype.define=function(a,b,f){var g,h,i;if(null==f&&(f={}),null!=this.definitions[a]&&!f.override){if(f.silent)return this;throw new TypeError('Factory#define Definition "'+a+'" already exists.\nUse override option to ignore.')}return null==(g=this.promises)[a]&&(g[a]=d.Deferred()),h={options:f},c.isFunction(b.extend)||(b.extend=e.Model.extend),c.isFunction(b)?h.constructor=b:h.constructor=function(){return c.clone(b)},h.constructor.prototype.__factory=function(a){return function(){return a}}(this),i=[a].concat(f.tags).concat(this.baseTags),h.tags=c.uniq(i).filter(function(a){return!!a}),this.instances[a]=[],c.each(h.tags,function(a){return function(b){return a.tagMap[b]=a.tagMap[b]||[],a.tagCbs[b]=a.tagCbs[b]||[]}}(this)),this.definitions[a]=h,this.trigger("define",a,h,f),this.promises[a].resolve(this,a),this},f.prototype.hasDefinition=function(a){return!!this.definitions[a]},f.prototype.whenDefined=function(a){var b;return null==(b=this.promises)[a]&&(b[a]=d.Deferred()),this.promises[a].promise()},f.prototype.fetchDefinition=function(a){var b;return b=this.whenDefined(a),require([a],function(b){return function(c){return b.define(a,c)}}(this)),b},f.prototype.extend=function(a,b,d,e){var f,g,i,j;if(null==e&&(e={}),f=this.definitions[a],!f)throw new ReferenceError('Factory#extend Base Class "'+a+'" Not Available.');if(!c.isObject(d))throw new TypeError("Factory#extend Invalid Argument.\n`definition` must be an Object.");return e.tags=c.chain([]).union(e.tags).union(f.tags).compact().value(),e.inheritMixins&&(e.mixins=c.chain([]).union(f.options.mixins).union(e.mixins).compact().value(),j=d.mixinOptions,i=f.constructor.prototype.mixinOptions,h(j,i)),null!=e.singleton?e.singleton=e.singleton:e.singleton=f.options.singleton,g=f.constructor.extend(d),this.define(b,g,e)},f.prototype.clone=function(a){var e;if(!(a instanceof f))throw new TypeError("Factory#clone Invalid Argument.\n`factory` must be an instance of Factory.");return e=[],c.each(["definitions","mixins","promises"],function(b){return function(d){return c.defaults(b[d],a[d]),"definitions"===d?c.each(b[d],function(a,c){return a.options.singleton&&e.push(c),b[d][c].constructor.prototype.__factory=function(){return b}}):void 0}}(this)),c.each(["tagCbs","tagMap","promises","instances"],function(f){return function(g){var h,i,j,k,l,m,n;null==f[g]&&(f[g]={}),l=a[g],m=[];for(j in l)k=l[j],"instances"===g&&b.call(e,j)>=0&&(n=!0),c.isArray(k)&&(null==(h=f[g])[j]&&(h[j]=[]),n?f[g][j]=f[g][j]:f[g][j]=k.concat(f[g][j])),c.isFunction(null!=k?k.resolve:void 0)?(null==(i=f[g])[j]&&(i[j]=d.Deferred()),m.push(f[g][j].done(k.resolve))):m.push(void 0);return m}}(this))},f.prototype.mirror=function(a){return a.off("create",a.handleCreate),c.chain(this).methods().each(function(b){return function(c){return a[c]=function(){return b[c].apply(b,arguments)}}}(this)),this.clone(a),c.chain(a).keys().each(function(b){return c.isFunction(a[b])?void 0:delete a[b]})},f.prototype.defineMixin=function(a,b,c){if(null==c&&(c={}),null!=this.mixins[a]&&!c.override)throw new TypeError("Factory#defineMixin Mixin "+a+" already defined.\nUse `override` option to ignore.");return this.mixins[a]={definition:b,options:c},this.trigger("defineMixin",a,b,c),this},f.prototype.composeMixinDependencies=function(a){var b,d,e,f,g;for(null==a&&(a=[]),g=[],b=0,d=a.length;d>b;b++)e=a[b],f=this.mixins[e].options,g=g.concat(this.composeMixinDependencies(f.mixins)),g.push(e);return c.uniq(g)},f.prototype.applyMixin=function(a,d){var e,f,g,h,i;if(i=this.mixins[d],e=i.definition,h=i.options,!e)throw new TypeError("Factory#applyMixin Mixin "+d+" not defined");return a.____mixed||(g=!0,f=!0,a.____mixed=[]),b.call(a.____mixed,d)>=0?void 0:(h.tags&&!f&&(a.____tags||(a.____tags=[]),a.____tags=a.____tags.concat(h.tags)),c.extend(a,c.omit(e,["mixinOptions","mixinitialize","mixconfig"])),g?(this.mixinitialize(a,d),delete a.____mixed):a.____mixed.push(d),a)},f.prototype.mixinitialize=function(a,b){var d,e;return d=this.mixins[b].definition,e=d.mixinitialize,c.isFunction(e)?e.call(a):void 0},f.prototype.handleMixins=function(b,d,e){var f,g,i,j,k,l,m,n,o,p,q,r,s,t,u;for(b.____mixed=[],b.mixinOptions=c.extend({},b.mixinOptions),f=[].concat(d,b.__mixins()),u=this.composeMixinDependencies(f),b.__mixins=function(){return u},i=0,l=u.length;l>i;i++)r=u[i],this.applyMixin(b,r);for(t=u.slice().reverse(),j=0,m=t.length;m>j;j++)r=t[j],g=this.mixins[r].definition,q=g.mixinOptions,s=b.mixinOptions,h(s,q),b.mixinOptions=c.extend({},q,s);for(k=0,n=u.length;n>k;k++)r=u[k],g=this.mixins[r].definition,s=b.mixinOptions,"function"==typeof g.mixconfig&&g.mixconfig.apply(g,[s].concat(a.call(e)));for(p=0,o=u.length;o>p;p++)r=u[p],this.mixinitialize(b,r);return b.__mixin=c.chain(function(a,b,c){return this.handleMixins(a,[b],c),delete a.____mixed}).bind(this).partial(b).value(),delete b.____mixed},f.prototype.handleInjections=function(a,b){var c,d,e;d=[];for(c in b)e=b[c],d.push(a[c]=this.get(e));return d},f.prototype.handleCreate=function(a){var b,d,e,f,g,h,i,j;for(i=a.__tags(),e=0,g=i.length;g>e;e++)if(j=i[e],null==this.tagCbs[j]&&(this.tagCbs[j]=[]),d=this.tagCbs[j],0!==d.length)for(f=0,h=d.length;h>f;f++)b=d[f],c.isFunction(b)&&b(a);return!0},f.prototype.handleTags=function(a,b,d){var e,f,g,h,i;for(this.instances[a].push(b),delete b.____tags,e=[this.instances[a]],h=b.__tags(),f=0,g=h.length;g>f;f++)i=h[f],null==this.tagMap[i]&&(this.tagMap[i]=[]),this.tagMap[i].push(b),e.push(this.tagMap[i]);return e=c.uniq(e),b.__factoryMap=function(){return[].slice.call(e)}},f.prototype.get=function(){var b,d,e,f,g,h,i,j,k,l,m;if(k=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],i=null!=(d=this.instances)[k]?d[k]:d[k]=[],h=this.instances[k][0],f=this.definitions[k],null==f)throw new TypeError("Factory#get Definition "+k+" is not defined.");return e=f.constructor,l=f.options||{},m=!!l.singleton,j=l.mixins||[],g=l.injections||[],m&&h?h:(h=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(e,b,function(){}),h.__type=function(){return k},h.__mixins=function(a){return function(){return a.composeMixinDependencies(j)}}(this),h.__tags=function(a){return function(){return a.getTags(h)}}(this),h.constructor=this.getConstructor(k),this.handleMixins(h,j,b),this.handleInjections(h,g),this.handleTags(k,h,f.tags),c.isFunction(h.constructed)&&h.constructed.apply(h,b),h.__dispose=function(a){return function(){return a.dispose(this)}}(this),this.trigger("create",h),h)},f.prototype.resolveInstance=function(){var b,d;return d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],c.isFunction(d)&&(d=d.call.apply(d,[this].concat(a.call(b)))),c.isString(d)?this.get.apply(this,[d].concat(a.call(b))):d},f.prototype.getTags=function(a){var b;return b=c.chain(a.__mixins()).map(function(a){return function(b){var c,d;return null!=(c=a.mixins[b])&&null!=(d=c.options)?d.tags:void 0}}(this)).flatten().compact().uniq().value(),c.chain([]).union(a.____tags).union(this.definitions[a.__type()].tags).union(b).compact().value()},f.prototype.verifyTags=function(a){return a.__factoryMap?c.all(a.__factoryMap(),function(c){return b.call(c,a)>=0}):!1},f.prototype.dispose=function(a){return c.each(a.__factoryMap(),function(c){var d;if(b.call(c,a)<0)throw new TypeError("Factory#dispose Instance Not In Factory.\nDisposal failed!");for(d=[];c.indexOf(a)>-1;)d.push(c.splice(c.indexOf(a),1));return d}),this.trigger("dispose",a)},f.prototype.getConstructor=function(a,b){var d;return null==b&&(b=!1),b?this.definitions[a].constructor:(d=c.chain(this.get).bind(this).partial(a).value(),d.prototype=this.definitions[a].constructor.prototype,d)},f.prototype.onTag=function(a,b){var d,e,f,g,h;if(!c.isString(a))throw new TypeError("Factory#onTag Invalid Argument.\n`tag` must be a String.");if(!c.isFunction(b))throw new TypeError("Factory#onTag Invalid Argument.\n`cb` must be a Function.");for(h=this.tagMap[a]||[],f=0,g=h.length;g>f;f++)e=h[f],b(e);return null==(d=this.tagCbs)[a]&&(d[a]=[]),this.tagCbs[a].push(b),!0},f.prototype.offTag=function(a,b){var d;if(!c.isString(a))throw new TypeError("Factory#offTag Invalid Argument.\n`tag` must be a String.");if(null!=this.tagCbs[a]){if(!c.isFunction(b))return void(this.tagCbs[a]=[]);if(d=this.tagCbs[a].indexOf(b),-1===d)throw new ReferenceError("Factory#offTag Callback Not Found for "+a+".");return this.tagCbs[a].splice(d,1)}},f.prototype.isType=function(a,b){return a.__type()===b},f.prototype.getType=function(a){return a.__type()},f}()})}).call(this);